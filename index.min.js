!function e(t,i,n){function a(o,r){if(!i[o]){if(!t[o]){var u="function"==typeof require&&require;if(!r&&u)return u(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return a(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){var n,a=function(e,t){function i(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},s={}.hasOwnProperty;n=e("events").EventEmitter,angular.module("util.audio",[]).config(function(e){return e.resourceUrlWhitelist(["self","filesystem:**","blob:**"])}).run(function(e){return e.put("templates/util.audio/recorder.html",'<button \n  class="button" \n  on-hold="model.start()"\n  on-release="model.stop()">\n  <i class="icon ion-mic-a"></i>\n</button>'),e.put("templates/util.audio/player.html",'<button class="button" ng-click="start()" style="vertical-align: middle">\n  <i class="icon ion-play"></i>\n</button>\n<span style="vertical-align: middle">\n  {{numeral(model.source.buffer.duration).format(\'00:00\')}}\n  {{model.source.buffer.paused}}\n</span>')}).directive("utilAudioRecorder",function(){return{restict:"E",templateUrl:function(e,t){return t.templateUrl||"templates/util.audio/recorder.html"},controller:function(e,t){return e.model=t.recorder}}}).directive("utilAudioPlayer",function(){return{restrict:"E",scope:{src:"@"},templateUrl:function(e,t){return t.templateUrl||"templates/util.audio/player.html"},controller:function(t,i,n){return t.model=n.player,t.numeral=e("./test/lib/numeral/numeral.js"),i.$observe("src",function(e,i){if(e!==i)return t.model.connect(e)}),t.start=function(){return t.model.start()},t.stop=function(){return t.model.stop()}}}}).factory("audioService",function(t){var i,s,o;return o=e("./test/lib/Wad/build/wad.js"),i=function(e){function i(){this.context=new i.AudioContext}var n;return a(i,e),i.AudioContext=window.AudioContext||webkitAudioContext,n=null,i.instance=function(){return null!=n?n:n=new i},i.prototype.connect=function(e){return this.url=e,t.get(this.url,{responseType:"arraybuffer"}).then(function(e){return function(t){return e.context.decodeAudioData(t.data,function(e){return Promise.resolve(e)})}}(this)).then(function(e){return function(t){return e.source=e.context.createBufferSource(),e.source.buffer=t,e.source.connect(e.context.createGain()).connect(e.context.destination)}}(this))},i.prototype.start=function(){return this.connect(this.url).then(function(e){return function(){var t;return null!=(t=e.source)&&t.start(),e.emit("start")}}(this)),this},i.prototype.stop=function(){var e;return null!=(e=this.source)&&e.stop(),this.emit("stop"),this},i}(n),s=function(e){function t(){this.media=new o.Poly({recConfig:{workerPath:"lib/Wad/src/Recorderjs/recorderWorker.js"}}),this.mic=new o({source:"mic"}),this.media.add(this.mic)}return a(t,e),t.prototype.start=function(){return this.media.rec.clear(),this.media.output.disconnect(this.media.destination),this.media.rec.record(),this.mic.play(),this.emit("start"),this},t.prototype.stop=function(){return this.mic.stop(),this.media.rec.stop(),this.media.output.connect(this.media.destination),this.media.rec.exportWAV(function(e){return function(t){return t.name="audio.wav",t.lastModifiedDate=new Date,e.file=t,e.url&&URL.revokeObjectURL(e.url),e.url=URL.createObjectURL(e.file),e.emit("stop")}}(this)),this},t}(n),{recorder:new s,player:i.instance()}})},{"./test/lib/Wad/build/wad.js":3,"./test/lib/numeral/numeral.js":4,events:2}],2:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(i=this._events[e],r(i))return!1;if(a(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(o(i))for(s=Array.prototype.slice.call(arguments,1),l=i.slice(),n=l.length,u=0;u<n;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=r(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var i,n,s,r;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||a(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],a(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,t,i){!function(e,n){"function"==typeof define&&define.amd?define([],function(){return e.Wad=n()}):"object"==typeof i?t.exports=n():e.Wad=n()}(this,function(){!function(e){var t="recorderWorker.js",i=function(e,i){var n=i||{},a=n.bufferLen||4096,s=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,a,s,s);var o=new Worker(n.workerPath||t);o.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:s}});var r,u=!1;this.node.onaudioprocess=function(e){if(u){for(var t=[],i=0;i<s;i++)t.push(e.inputBuffer.getChannelData(i));o.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(){u=!0},this.stop=function(){u=!1},this.clear=function(){o.postMessage({command:"clear"})},this.getBuffer=function(e){r=e||n.callback,o.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(r=e||n.callback,t=t||n.type||"audio/wav",!r)throw new Error("Callback not set");o.postMessage({command:"exportWAV",type:t})},o.onmessage=function(e){var t=e.data;r(t)},e.connect(this.node),this.node.connect(this.context.destination)};i.forceDownload=function(t,i){var n=(e.URL||e.webkitURL).createObjectURL(t),a=e.document.createElement("a");a.href=n,a.download=i||"output.wav";var s=document.createEvent("Event");s.initEvent("click",!0,!0),a.dispatchEvent(s)},e.Recorder=i}(window),function(e){function i(){return n}function n(t){if(!(this instanceof n))return new n(t);if(e.AudioContext||(e.AudioContext=e.webkitAudioContext),t||(console.log("tuna.js: Missing audio context! Creating a new context for you."),t=e.AudioContext&&new e.AudioContext),!t)throw new Error("Tuna cannot initialize because this environment does not support web audio.");a(t),c=t,h=this}function a(e){function t(){var e=arguments[0];return arguments[0]=p.isPrototypeOf?p.isPrototypeOf(e)?e.input:e:e.input||e,a.apply(this,arguments),e}if(e.__connectified__!==!0){var i=e.createGain(),n=Object.getPrototypeOf(Object.getPrototypeOf(i)),a=n.connect;n.connect=t,e.__connectified__=!0}}function s(e){return Math.max(0,Math.round(100*Math.pow(2,e/6))/100)}function o(e,t){var i,n,a=0,s=0,o=0,r=0;return i=e.toExponential().match(/^.\.?(.*)e(.+)$/),a=parseInt(i[2],10)-(i[1]+"").length,i=t.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(i[2],10)-(i[1]+"").length,s>a&&(a=s),n=e%t,a<-100||a>20?(o=Math.round(Math.log(n)/Math.log(10)),r=Math.pow(10,o),(n/r).toFixed(o-a)*r):parseFloat(n.toFixed(-a))}function r(e){return 0===e?1:Math.abs(e)/e}function u(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function l(e,t){return void 0===e?t:e}var c,h,f=function(e,t){e.value=t},p=Object.create(null,{activate:{writable:!0,value:function(e){e?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(e)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(e){this._lastBypassValue!==e&&(this._bypass=e,this.activate(!e),this._lastBypassValue=e)}},connect:{value:function(e){this.output.connect(e)}},disconnect:{value:function(e){this.output.disconnect(e)}},connectInOrder:{value:function(e){for(var t=e.length-1;t--;){if(!e[t].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",e[t]);e[t+1].input?e[t].connect(e[t+1].input):e[t].connect(e[t+1])}}},getDefaults:{value:function(){var e={};for(var t in this.defaults)e[t]=this.defaults[t].value;return e}},automate:{value:function(e,t,i,n){var a,s=n?~~(n/1e3):c.currentTime,o=i?~~(i/1e3):0,r=this.defaults[e],u=this[e];u?r.automatable?(i?(a="linearRampToValueAtTime",u.cancelScheduledValues(s),u.setValueAtTime(u.value,s)):a="setValueAtTime",u[a](t,o+s)):u=t:console.error("Invalid Property for "+this.name)}}}),d="float",v="boolean",m="string",y="int";"undefined"!=typeof t&&t.exports?t.exports=n:"function"==typeof define?e.define("Tuna",i):e.Tuna=n,n.prototype.Bitcrusher=function(e){e||(e=this.getDefaults()),this.bufferSize=e.bufferSize||this.defaults.bufferSize.value,this.input=c.createGain(),this.activateNode=c.createGain(),this.processor=c.createScriptProcessor(this.bufferSize,1,1),this.output=c.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var t,i,n,a,s,o=0,r=0;this.processor.onaudioprocess=function(e){for(t=e.inputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(0),n=Math.pow(.5,this.bits),s=t.length,a=0;a<s;a++)o+=this.normfreq,o>=1&&(o-=1,r=n*Math.floor(t[a]/n+.5)),i[a]=r},this.bits=e.bits||this.defaults.bits.value,this.normfreq=l(e.normfreq,this.defaults.normfreq.value),this.bypass=e.bypass||!1},n.prototype.Bitcrusher.prototype=Object.create(p,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:y},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:y},bypass:{value:!1,automatable:!1,type:v},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:d}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(e){this.processor.bits=e}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(e){this.processor.normfreq=e}}}),n.prototype.Cabinet=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.convolver=this.newConvolver(e.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=c.createGain(),this.output=c.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=l(e.makeupGain,this.defaults.makeupGain),this.bypass=e.bypass||!1},n.prototype.Cabinet.prototype=Object.create(p,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:d},bypass:{value:!1,automatable:!1,type:v}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=e}},newConvolver:{value:function(e){return new h.Convolver({impulse:e,dryLevel:0,wetLevel:1})}}}),n.prototype.Chorus=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.attenuator=this.activateNode=c.createGain(),this.splitter=c.createChannelSplitter(2),this.delayL=c.createDelay(),this.delayR=c.createDelay(),this.feedbackGainNodeLR=c.createGain(),this.feedbackGainNodeRL=c.createGain(),this.merger=c.createChannelMerger(2),this.output=c.createGain(),this.lfoL=new h.LFO({target:this.delayL.delayTime,callback:f}),this.lfoR=new h.LFO({target:this.delayR.delayTime,callback:f}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=l(e.feedback,this.defaults.feedback.value),this.rate=l(e.rate,this.defaults.rate.value),this.delay=l(e.delay,this.defaults.delay.value),this.depth=l(e.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Chorus.prototype=Object.create(p,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:d},delay:{value:.0045,min:0,max:1,automatable:!1,type:d},depth:{value:.7,min:0,max:1,automatable:!1,type:d},rate:{value:1.5,min:0,max:8,automatable:!1,type:d},bypass:{value:!1,automatable:!1,type:v}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(e){this._delay=2e-4*(2*Math.pow(10,e)),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),n.prototype.Compressor=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.compNode=this.activateNode=c.createDynamicsCompressor(),this.makeupNode=c.createGain(),this.output=c.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=l(e.automakeup,this.defaults.automakeup.value),this.makeupGain=e.makeupGain||this.defaults.makeupGain.value,this.threshold=l(e.threshold,this.defaults.threshold.value),this.release=e.release||this.defaults.release.value,this.attack=l(e.attack,this.defaults.attack.value),this.ratio=e.ratio||this.defaults.ratio.value,this.knee=l(e.knee,this.defaults.knee.value),this.bypass=e.bypass||!1},n.prototype.Compressor.prototype=Object.create(p,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:d},release:{value:250,min:10,max:2e3,automatable:!0,type:d},makeupGain:{value:1,min:1,max:100,automatable:!0,type:d},attack:{value:1,min:0,max:1e3,automatable:!0,type:d},ratio:{value:4,min:1,max:50,automatable:!0,type:d},knee:{value:5,min:0,max:40,automatable:!0,type:d},automakeup:{value:!1,automatable:!1,type:v},bypass:{value:!1,automatable:!1,type:v}}},computeMakeup:{value:function(){var e=4,t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/e}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(e){this._automakeup=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(e){this.compNode.threshold.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(e){this.compNode.ratio.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(e){this.compNode.knee.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(e){this.compNode.attack.value=e/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(e){this.compNode.release=e/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=s(e)}}}),n.prototype.Convolver=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.convolver=c.createConvolver(),this.dry=c.createGain(),this.filterLow=c.createBiquadFilter(),this.filterHigh=c.createBiquadFilter(),this.wet=c.createGain(),this.output=c.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=l(e.dryLevel,this.defaults.dryLevel.value),this.wetLevel=l(e.wetLevel,this.defaults.wetLevel.value),this.highCut=e.highCut||this.defaults.highCut.value,this.buffer=e.impulse||"../impulses/ir_rev_short.wav",this.lowCut=e.lowCut||this.defaults.lowCut.value,this.level=l(e.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=e.bypass||!1},n.prototype.Convolver.prototype=Object.create(p,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:d},lowCut:{value:20,min:20,max:22050,automatable:!0,type:d},dryLevel:{value:1,min:0,max:1,automatable:!0,type:d},wetLevel:{value:1,min:0,max:1,automatable:!0,type:d},level:{value:1,min:0,max:1,automatable:!0,type:d}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(e){this.filterLow.frequency.value=e}},highCut:{get:function(){return this.filterHigh.frequency},set:function(e){this.filterHigh.frequency.value=e}},level:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=e}},dryLevel:{get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},wetLevel:{get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(e){var t=this.convolver,i=new XMLHttpRequest;return e?(i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(i.status<300&&i.status>199||302===i.status)&&c.decodeAudioData(i.response,function(e){t.buffer=e},function(e){e&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+e)})},void i.send(null)):void console.log("Tuna.Convolver.setBuffer: Missing impulse path!")}}}),n.prototype.Delay=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.dry=c.createGain(),this.wet=c.createGain(),this.filter=c.createBiquadFilter(),this.delay=c.createDelay(),this.feedbackNode=c.createGain(),this.output=c.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=e.delayTime||this.defaults.delayTime.value,this.feedback=l(e.feedback,this.defaults.feedback.value),this.wetLevel=l(e.wetLevel,this.defaults.wetLevel.value),this.dryLevel=l(e.dryLevel,this.defaults.dryLevel.value),this.cutoff=e.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=e.bypass||!1},n.prototype.Delay.prototype=Object.create(p,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:d},feedback:{value:.45,min:0,max:.9,automatable:!0,type:d},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:d},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:d},dryLevel:{value:1,min:0,max:1,automatable:!0,type:d}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(e){this.delay.delayTime.value=e/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=e}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),n.prototype.Filter=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.filter=c.createBiquadFilter(),this.output=c.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=e.frequency||this.defaults.frequency.value,this.Q=e.resonance||this.defaults.Q.value,this.filterType=l(e.filterType,this.defaults.filterType.value),this.gain=l(e.gain,this.defaults.gain.value),this.bypass=e.bypass||!1},n.prototype.Filter.prototype=Object.create(p,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:d},Q:{value:1,min:.001,max:100,automatable:!0,type:d},gain:{value:0,min:-40,max:40,automatable:!0,type:d},bypass:{value:!1,automatable:!1,type:v},filterType:{value:"lowpass",automatable:!1,type:m}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(e){this.filter.type=e}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(e){this.filter.Q.value=e}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(e){this.filter.gain.value=e}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),n.prototype.MoogFilter=function(e){e||(e=this.getDefaults()),this.bufferSize=e.bufferSize||this.defaults.bufferSize.value,this.input=c.createGain(),this.activateNode=c.createGain(),this.processor=c.createScriptProcessor(this.bufferSize,1,1),this.output=c.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var t,i,n,a,s,o,r,u;t=i=n=a=s=o=r=u=0;var h,f,p,d,v,m;this.processor.onaudioprocess=function(e){for(h=e.inputBuffer.getChannelData(0),f=e.outputBuffer.getChannelData(0),p=1.16*this.cutoff,inputFactor=.35013*(p*p)*(p*p),d=this.resonance*(1-.15*p*p),m=h.length,v=0;v<m;v++)h[v]-=u*d,h[v]*=inputFactor,s=h[v]+.3*t+(1-p)*s,t=h[v],o=s+.3*i+(1-p)*o,i=s,r=o+.3*n+(1-p)*r,n=o,u=r+.3*a+(1-p)*u,a=r,f[v]=u},this.cutoff=l(e.cutoff,this.defaults.cutoff.value),this.resonance=l(e.resonance,this.defaults.resonance.value),this.bypass=e.bypass||!1},n.prototype.MoogFilter.prototype=Object.create(p,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:y},bypass:{value:!1,automatable:!1,type:v},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:d},resonance:{value:3.5,min:0,max:4,automatable:!1,type:d}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(e){this.processor.cutoff=e}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(e){this.processor.resonance=e}}}),n.prototype.Overdrive=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.inputDrive=c.createGain(),this.waveshaper=c.createWaveShaper(),this.outputDrive=c.createGain(),this.output=c.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=l(e.drive,this.defaults.drive.value),this.outputGain=l(e.outputGain,this.defaults.outputGain.value),this.curveAmount=l(e.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=l(e.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=e.bypass||!1},n.prototype.Overdrive.prototype=Object.create(p,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:d,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:d,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:d},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:y}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(e){this._drive=e}},curveAmount:{get:function(){return this._curveAmount},set:function(e){this._curveAmount=e,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(e){this._outputGain=s(e)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(e){this._algorithmIndex=e,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(e,t,i){e=Math.min(e,.9999);var n,a,s=2*e/(1-e);for(n=0;n<t;n++)a=2*n/t-1,i[n]=(1+s)*a/(1+s*Math.abs(a))},function(e,t,i){var n,a,s;for(n=0;n<t;n++)a=2*n/t-1,s=(.5*Math.pow(a+1.4,2)-1)*s>=0?5.8:1.2,i[n]=u(s)},function(e,t,i){var n,a,s,o=1-e;for(n=0;n<t;n++)a=2*n/t-1,s=a<0?-Math.pow(Math.abs(a),o+.04):Math.pow(a,o),i[n]=u(2*s)},function(e,t,i){var n,a,s,o,u=1-e>.99?.99:1-e;for(n=0;n<t;n++)a=2*n/t-1,o=Math.abs(a),o<u?s=o:o>u?s=u+(o-u)/(1+Math.pow((o-u)/(1-u),2)):o>1&&(s=o),i[n]=r(a)*s*(1/((u+1)/2))},function(e,t,i){var n,a;for(n=0;n<t;n++)a=2*n/t-1,a<-.08905?i[n]=-.75*(1-Math.pow(1-(Math.abs(a)-.032857),12)+1/3*(Math.abs(a)-.032847))+.01:a>=-.08905&&a<.320018?i[n]=-6.153*(a*a)+3.9375*a:i[n]=.630035},function(e,t,i){var n,a,s=2+Math.round(14*e),o=Math.round(Math.pow(2,s-1));for(n=0;n<t;n++)a=2*n/t-1,i[n]=Math.round(a*o)/o}]}}),n.prototype.Phaser=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.splitter=this.activateNode=c.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=c.createGain(),this.feedbackGainNodeR=c.createGain(),this.merger=c.createChannelMerger(2),this.filteredSignal=c.createGain(),this.output=c.createGain(),this.lfoL=new h.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new h.LFO({target:this.filtersR,callback:this.callback});for(var t=this.stage;t--;)this.filtersL[t]=c.createBiquadFilter(),this.filtersR[t]=c.createBiquadFilter(),this.filtersL[t].type="allpass",this.filtersR[t].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=l(e.rate,this.defaults.rate.value),this.baseModulationFrequency=e.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=l(e.depth,this.defaults.depth.value),this.feedback=l(e.feedback,this.defaults.feedback.value),this.stereoPhase=l(e.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Phaser.prototype=Object.create(p,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:d},depth:{value:.6,min:0,max:1,automatable:!1,type:d},feedback:{value:.7,min:0,max:1,automatable:!1,type:d},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:d},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:d}}},callback:{value:function(e,t){for(var i=0;i<4;i++)e[i].frequency.value=t}},depth:{get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(e){this._baseModulationFrequency=e,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=o(t,2*Math.PI),this.lfoR._phase=t}}}),n.prototype.PingPongDelay=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.wetLevel=c.createGain(),this.stereoToMonoMix=c.createGain(),this.feedbackLevel=c.createGain(),this.output=c.createGain(),this.delayLeft=c.createDelay(),this.delayRight=c.createDelay(),this.activateNode=c.createGain(),this.splitter=c.createChannelSplitter(2),this.merger=c.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==e.delayTimeLeft?e.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==e.delayTimeRight?e.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==e.feedback?e.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==e.wetLevel?e.wetLevel:this.defaults.wetLevel.value,this.bypass=e.bypass||!1},n.prototype.PingPongDelay.prototype=Object.create(p,{
name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(e){this._delayTimeLeft=e,this.delayLeft.delayTime.value=e/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(e){this._delayTimeRight=e,this.delayRight.delayTime.value=e/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:y},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:y},feedback:{value:.3,min:0,max:1,automatable:!1,type:d},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:d}}}}),n.prototype.Tremolo=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.splitter=this.activateNode=c.createChannelSplitter(2),this.amplitudeL=c.createGain(),this.amplitudeR=c.createGain(),this.merger=c.createChannelMerger(2),this.output=c.createGain(),this.lfoL=new h.LFO({target:this.amplitudeL.gain,callback:f}),this.lfoR=new h.LFO({target:this.amplitudeR.gain,callback:f}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=e.rate||this.defaults.rate.value,this.intensity=l(e.intensity,this.defaults.intensity.value),this.stereoPhase=l(e.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Tremolo.prototype=Object.create(p,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:d},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:d},rate:{value:5,min:.1,max:11,automatable:!1,type:d}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(e){this._intensity=e,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=o(t,2*Math.PI),this.lfoR.phase=t}}}),n.prototype.WahWah=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.activateNode=c.createGain(),this.envelopeFollower=new h.EnvelopeFollower({target:this,callback:function(e,t){e.sweep=t}}),this.filterBp=c.createBiquadFilter(),this.filterPeaking=c.createBiquadFilter(),this.output=c.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=l(e.enableAutoMode,this.defaults.automode.value),this.resonance=e.resonance||this.defaults.resonance.value,this.sensitivity=l(e.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=l(e.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=e.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=l(e.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=e.bypass||!1},n.prototype.WahWah.prototype=Object.create(p,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:v},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:d},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:d},sweep:{value:.2,min:0,max:1,automatable:!1,type:d},resonance:{value:10,min:1,max:100,automatable:!1,type:d},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:d}}},activateCallback:{value:function(e){this.automode=e}},automode:{get:function(){return this._automode},set:function(e){this._automode=e,e?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}catch(e){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(e){this._sweep=Math.pow(e>1?1:e<0?0:e,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=50*Math.pow(10,2*e),this._excursionFrequency=Math.min(c.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(e){this._excursionOctaves=e,this._excursionFrequency=Math.min(c.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(e){this._sensitivity=Math.pow(10,e)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(e){this._resonance=e,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),n.prototype.EnvelopeFollower=function(e){e||(e=this.getDefaults()),this.input=c.createGain(),this.jsNode=this.output=c.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=l(e.attackTime,this.defaults.attackTime.value),this.releaseTime=l(e.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=e.target||{},this.callback=e.callback||function(){}},n.prototype.EnvelopeFollower.prototype=Object.create(p,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:d},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:d}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(e){this._attackTime=e,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(e){this._releaseTime=e,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(e){"function"==typeof e?this._callback=e:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(e){this.activated=e,e?(this.jsNode.connect(c.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(e){return function(t){e.compute(t)}}},compute:{value:function(e){var t,i,n,a,s=e.inputBuffer.getChannelData(0).length,o=e.inputBuffer.numberOfChannels;if(i=n=a=0,o>1)for(a=0;a<s;++a)for(;i<o;++i)t=e.inputBuffer.getChannelData(i)[a],n+=t*t/o;else for(a=0;a<s;++a)t=e.inputBuffer.getChannelData(0)[a],n+=t*t;n=Math.sqrt(n),this._envelope<n?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*n):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*n),this._callback(this._target,this._envelope)}}}),n.prototype.LFO=function(e){this.output=c.createScriptProcessor(256,1,1),this.activateNode=c.destination,this.frequency=l(e.frequency,this.defaults.frequency.value),this.offset=l(e.offset,this.defaults.offset.value),this.oscillation=l(e.oscillation,this.defaults.oscillation.value),this.phase=l(e.phase,this.defaults.phase.value),this.target=e.target||{},this.output.onaudioprocess=this.callback(e.callback||function(){}),this.bypass=e.bypass||!1},n.prototype.LFO.prototype=Object.create(p,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:d},offset:{value:.85,min:0,max:22049,automatable:!1,type:d},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:d},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:d}}},frequency:{get:function(){return this._frequency},set:function(e){this._frequency=e,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(e){this._offset=e}},oscillation:{get:function(){return this._oscillation},set:function(e){this._oscillation=e}},phase:{get:function(){return this._phase},set:function(e){this._phase=e}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(e){e?this.output.connect(c.destination):this.output.disconnect(c.destination)}},callback:{value:function(e){var t=this;return function(){t._phase+=t._phaseInc,t._phase>2*Math.PI&&(t._phase=0),e(t._target,t._offset+t._oscillation*Math.sin(t._phase))}}}}),n.toString=n.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}}(this);var e=window.AudioContext||window.webkitAudioContext,i=new e,n=function(e){if(e.navigator.mediaDevices&&e.navigator.mediaDevices.getUserMedia)return e.navigator.mediaDevices.getUserMedia.bind(e.navigator.mediaDevices);var t=e.navigator.getUserMedia||e.navigator.webkitGetUserMedia||e.navigator.mozGetUserMedia;return t?function(i){return new Promise(function(n,a){t.call(e.navigator,i,n,a)})}:function(){throw"getUserMedia is unsupported"}}(window);n?console.log("Your browser supports getUserMedia."):console.log("Your browser does not support getUserMedia.");var a=function(){function e(e,t){var i=4,n=1e3,a=1e3,s=-1,o=0,r=0,u=!1;if(e.length<a+n-i)return-1;for(var l=0;l<a;l++){var c=(e[l]-128)/128;r+=c*c}if(r=Math.sqrt(r/a),r<.01)return-1;for(var h=1,f=i;f<=n;f++){for(var p=0,l=0;l<a;l++)p+=Math.abs((e[l]-128)/128-(e[l+f]-128)/128);if(p=1-p/a,p>.9&&p>h)u=!0;else if(u)return t/s;h=p,p>o&&(o=p,s=f)}return o>.01?t/s:-1}var t=function(){Math.seed=6,Math.seededRandom=function(e,t){e=e||1,t=t||0,Math.seed=(9301*Math.seed+49297)%233280;var i=Math.seed/233280;return t+i*(e-t)};for(var e=2*i.sampleRate,t=i.createBuffer(1,e,i.sampleRate),n=t.getChannelData(0),a=0;a<e;a++)n[a]=2*Math.seededRandom()-1;return t}(),a=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e,t){e.env={attack:t.env?R(t.env.attack,1):0,decay:t.env?R(t.env.decay,0):0,sustain:t.env?R(t.env.sustain,1):1,hold:t.env?R(t.env.hold,3.14159):3.14159,release:t.env?R(t.env.release,0):0},e.defaultEnv={attack:t.env?R(t.env.attack,1):0,decay:t.env?R(t.env.decay,0):0,sustain:t.env?R(t.env.sustain,1):1,hold:t.env?R(t.env.hold,3.14159):3.14159,release:t.env?R(t.env.release,0):0}},o=function(e,t){t.filter?a(t.filter)?e.filter=t.filter.map(function(e){return{type:e.type||"lowpass",frequency:e.frequency||600,q:e.q||1,env:e.env||null}}):e.filter=[{type:t.filter.type||"lowpass",frequency:t.filter.frequency||600,q:t.filter.q||1,env:t.filter.env||null}]:t.filter=null},r=function(e,t){var n=new XMLHttpRequest;n.open("GET",e.source,!0),n.responseType="arraybuffer",e.playable--,n.onload=function(){i.decodeAudioData(n.response,function(i){e.decodedBuffer=i,3.14159===e.env.hold&&(e.env.hold=e.decodedBuffer.duration+1),t&&t(e),e.playable++,e.playOnLoad&&e.play(e.playOnLoadArg)})},n.send()},u=function(e,t){t.vibrato?e.vibrato={shape:R(t.vibrato.shape,"sine"),speed:R(t.vibrato.speed,1),magnitude:R(t.vibrato.magnitude,5),attack:R(t.vibrato.attack,0)}:e.vibrato=null},l=function(e,t){t.tremolo?e.tremolo={shape:R(t.tremolo.shape,"sine"),speed:R(t.tremolo.speed,1),magnitude:R(t.tremolo.magnitude,5),attack:R(t.tremolo.attack,1)}:e.tremolo=null},c=function(e,t){if(t.reverb){e.reverb={wet:R(t.reverb.wet,1)};var n=t.reverb.impulse||v.defaultImpulse,a=new XMLHttpRequest;a.open("GET",n,!0),a.responseType="arraybuffer",e.playable--,a.onload=function(){i.decodeAudioData(a.response,function(i){e.reverb.buffer=i,e.playable++,e.playOnLoad&&e.play(e.playOnLoadArg),e instanceof v.Poly&&e.setUp(t),"mic"===e.source&&e.reverb&&e.reverb.buffer&&e.reverb.node&&!e.reverb.node.buffer&&(e.reverb.node.convolver.buffer=e.reverb.buffer)})},a.send()}else e.reverb=null},h=function(e,t){"panning"in t?(e.panning={location:t.panning},"number"==typeof t.panning?e.panning.type="stereo":(e.panning.type="3d",e.panning.panningModel=t.panningModel||"equalpower")):e.panning={location:0,type:"stereo"},"stereo"!==e.panning.type||i.createStereoPanner||(console.log("Your browser does not support stereo panning. Falling back to 3D panning."),e.panning={location:[0,0,0],type:"3d",panningModel:"equalpower"})},f=function(e,t){t.delay?e.delay={delayTime:R(t.delay.delayTime,.5),maxDelayTime:R(t.delay.maxDelayTime,2),feedback:R(t.delay.feedback,.25),wet:R(t.delay.wet,.25)}:e.delay=null},p=function(e,t){return e.nodes=[],e.mediaStreamSource=null,e.gain=null,n({audio:!0,video:!1}).then(function(n){return e.mediaStreamSource=i.createMediaStreamSource(n),v.micConsent=!0,d(e,t),e}).catch(function(e){console.log("Error setting up microphone input: ",e)})},d=function(e,t){e.nodes=[],e.gain=i.createGain(),e.gain.gain.value=R(t.volume,e.volume),e.nodes.push(e.mediaStreamSource),e.nodes.push(e.gain),(e.filter||t.filter)&&_(e,t),(e.reverb||t.reverb)&&x(e,t),h(e,t),M(e,t),(e.delay||t.delay)&&T(e,t),C(e,t),e.setUpExternalFxOnPlay(t,i)},v=function(e){if(this.source=e.source,this.destination=e.destination||i.destination,this.volume=R(e.volume,1),this.defaultVolume=this.volume,this.playable=1,this.pitch=v.pitches[e.pitch]||e.pitch||440,this.detune=e.detune||0,this.globalReverb=e.globalReverb||!1,this.gain=[],this.loop=e.loop||!1,this.tuna=e.tuna||null,s(this,e),o(this,e),u(this,e),l(this,e),c(this,e),this.constructExternalFx(e,i),h(this,e),f(this,e),"noise"===this.source)this.decodedBuffer=t;else if("mic"===this.source)p(this,e);else if("object"==typeof this.source){var n=i.createBuffer(2,this.source[0].length,i.sampleRate);n.getChannelData(0).set(this.source[0]),n.getChannelData(1).set(this.source[1]),this.decodedBuffer=n}else this.source in{sine:0,sawtooth:0,square:0,triangle:0}?e.callback&&e.callback(this):r(this,e.callback)};v.micConsent=!1,v.audioContext=i,void 0!=window.Tuna&&(v.tuna=new Tuna(v.audioContext));var m=function(e,t){e.filter.forEach(function(e,i){e.node.frequency.linearRampToValueAtTime(e.frequency,t.exactTime),e.node.frequency.linearRampToValueAtTime(e.env.frequency,t.exactTime+e.env.attack)})},y=function(e,t){e.gain[0].gain.linearRampToValueAtTime(1e-4,t.exactTime),e.gain[0].gain.linearRampToValueAtTime(e.volume,t.exactTime+e.env.attack+1e-5),e.gain[0].gain.linearRampToValueAtTime(e.volume*e.env.sustain,t.exactTime+e.env.attack+e.env.decay+2e-5),e.gain[0].gain.linearRampToValueAtTime(e.volume*e.env.sustain,t.exactTime+e.env.attack+e.env.decay+e.env.hold+3e-5),e.gain[0].gain.linearRampToValueAtTime(1e-4,t.exactTime+e.env.attack+e.env.decay+e.env.hold+e.env.release+4e-5),e.soundSource.start(t.exactTime),e.soundSource.stop(t.exactTime+e.env.attack+e.env.decay+e.env.hold+e.env.release)},b=function(e,t){for(var i=t&&t.destination||e.destination,n=1;n<e.nodes.length;n++){if("custom"===e.nodes[n-1].interface)var a=e.nodes[n-1].output;else var a=e.nodes[n-1];if("custom"===e.nodes[n].interface)var s=e.nodes[n].input;else var s=e.nodes[n];a.connect(s)}if("custom"===e.nodes[e.nodes.length-1].interface)var o=e.nodes[e.nodes.length-1].output;else var o=e.nodes[e.nodes.length-1];o.connect(i),v.reverb&&e.globalReverb&&(e.nodes[e.nodes.length-1].connect(v.reverb.node),v.reverb.node.connect(v.reverb.gain),v.reverb.gain.connect(i))},g=function(e,t){t=t||{},e.soundSource=i.createOscillator(),e.soundSource.type=e.source,t.pitch?t.pitch in v.pitches?e.soundSource.frequency.value=v.pitches[t.pitch]:e.soundSource.frequency.value=t.pitch:e.soundSource.frequency.value=e.pitch,e.soundSource.detune.value=t.detune||e.detune},w=function(e,t){t&&t.env?(e.env.attack=R(t.env.attack,e.defaultEnv.attack),e.env.decay=R(t.env.decay,e.defaultEnv.decay),e.env.sustain=R(t.env.sustain,e.defaultEnv.sustain),e.env.hold=R(t.env.hold,e.defaultEnv.hold),e.env.release=R(t.env.release,e.defaultEnv.release)):e.env={attack:e.defaultEnv.attack,decay:e.defaultEnv.decay,sustain:e.defaultEnv.sustain,hold:e.defaultEnv.hold,release:e.defaultEnv.release}},_=function(e,t){t.filter&&!a(t.filter)&&(t.filter=[t.filter]),e.filter.forEach(function(n,a){n.node=i.createBiquadFilter(),n.node.type=n.type,n.node.frequency.value=t.filter&&t.filter[a]?t.filter[a].frequency||n.frequency:n.frequency,n.node.Q.value=t.filter&&t.filter[a]?t.filter[a].q||n.q:n.q,(t.filter&&t.filter[a].env||e.filter[a].env)&&"mic"!==e.source&&(n.env={attack:t.filter&&t.filter[a].env&&t.filter[a].env.attack||e.filter[a].env.attack,frequency:t.filter&&t.filter[a].env&&t.filter[a].env.frequency||e.filter[a].env.frequency}),e.nodes.push(n.node)})},k=function(e,t){t&&t.filter&&e.filter?(a(t.filter)||(t.filter=[t.filter]),_(e,t)):e.filter&&_(e,e)},x=function(e,t){var n={interface:"custom",input:i.createGain(),convolver:i.createConvolver(),wet:i.createGain(),output:i.createGain()};n.convolver.buffer=e.reverb.buffer,n.wet.gain.value=e.reverb.wet,n.input.connect(n.convolver),n.input.connect(n.output),n.convolver.connect(n.wet),n.wet.connect(n.output),e.reverb.node=n,e.nodes.push(e.reverb.node)},M=function(e,t){var n=t&&t.panning;"undefined"==typeof n&&(n=e.panning.location),"number"==typeof n?(e.panning.node=i.createStereoPanner(),e.panning.node.pan.value=n,e.panning.type="stereo"):(e.panning.node=i.createPanner(),e.panning.node.setPosition(n[0],n[1],n[2]),e.panning.node.panningModel=t.panningModel||e.panningModel||"equalpower",e.panning.type="3d"),e.nodes.push(e.panning.node)},L=function(e,t){e.vibrato.wad=new v({source:e.vibrato.shape,pitch:e.vibrato.speed,volume:e.vibrato.magnitude,env:{attack:e.vibrato.attack},destination:e.soundSource.frequency}),e.vibrato.wad.play()},G=function(e,t){e.tremolo.wad=new v({source:e.tremolo.shape,pitch:e.tremolo.speed,volume:e.tremolo.magnitude,env:{attack:e.tremolo.attack,hold:10},destination:e.gain[0].gain}),e.tremolo.wad.play()},T=function(e,t){if(e.delay){t.delay||(t.delay={});var n={interface:"custom",input:i.createGain(),output:i.createGain(),delayNode:i.createDelay(e.delay.maxDelayTime),feedbackNode:i.createGain(),wetNode:i.createGain()};n.delayNode.delayTime.value=R(t.delay.delayTime,e.delay.delayTime),n.feedbackNode.gain.value=R(t.delay.feedback,e.delay.feedback),n.wetNode.gain.value=R(t.delay.wet,e.delay.wet),n.input.connect(n.delayNode),n.input.connect(n.output),n.delayNode.connect(n.feedbackNode),n.delayNode.connect(n.wetNode),n.feedbackNode.connect(n.delayNode),n.wetNode.connect(n.output),e.delay.delayNode=n,e.nodes.push(n)}},q=function(e,t){e.compressor=i.createDynamicsCompressor(),e.compressor.attack.value=R(t.compressor.attack,e.compressor.attack.value),e.compressor.knee.value=R(t.compressor.knee,e.compressor.knee.value),e.compressor.ratio.value=R(t.compressor.ratio,e.compressor.ratio.value),e.compressor.release.value=R(t.compressor.release,e.compressor.release.value),e.compressor.threshold.value=R(t.compressor.threshold,e.compressor.threshold.value),e.nodes.push(e.compressor)},C=function(e,t){if(e.tuna||t.tuna){var i={};if(e.tuna)for(var n in e.tuna)i[n]=e.tuna[n];if(t.tuna)for(var n in t.tuna)i[n]=t.tuna[n];console.log("tunaconfig: ",i);for(var n in i){console.log(n);var a=new v.tuna[n](i[n]);e.nodes.push(a)}}};v.prototype.constructExternalFx=function(e,t){},v.prototype.setUpExternalFxOnPlay=function(e,t){},v.prototype.play=function(e){return e=e||{arg:null},this.playable<1?(this.playOnLoad=!0,this.playOnLoadArg=e):"mic"===this.source?v.micConsent?null===e.arg?b(this,e):(o(this,e),u(this,e),l(this,e),c(this,e),this.constructExternalFx(e,i),h(this,e),f(this,e),d(this,e),b(this,e)):(console.log("You have not given your browser permission to use your microphone."),p(this,e).then(function(t){t.play(e)})):(this.nodes=[],e.wait||(e.wait=0),e.volume?this.volume=e.volume:this.volume=this.defaultVolume,this.source in{sine:0,sawtooth:0,square:0,triangle:0}?g(this,e):(this.soundSource=i.createBufferSource(),this.soundSource.buffer=this.decodedBuffer,("noise"===this.source||this.loop||e.loop)&&(this.soundSource.loop=!0)),void 0===e.exactTime&&(e.exactTime=i.currentTime+e.wait),this.nodes.push(this.soundSource),w(this,e),k(this,e),C(this,e),this.setUpExternalFxOnPlay(e,i),this.gain.unshift(i.createGain()),this.gain[0].label=e.label,this.nodes.push(this.gain[0]),this.gain.length>15&&(this.gain.length=15),this.reverb&&x(this,e),M(this,e),T(this,e),b(this,e),this.filter&&this.filter[0].env&&m(this,e),y(this,e),this.vibrato&&L(this,e),this.tremolo&&G(this,e)),e.callback&&e.callback(this),this},v.prototype.setVolume=function(e){return this.defaultVolume=e,this.gain.length>0&&(this.gain[0].gain.value=e),this},v.prototype.setSpeed=function(e){var t;return t=e&&e>0?e:0,this.soundSource?this.soundSource.playbackRate.value=t:console.log("Sorry, but the wad does not contain a soundSource!"),this},v.prototype.setPitch=function(e){return e in v.pitches?this.soundSource.frequency.value=v.pitches[e]:this.soundSource.frequency.value=e,this},v.prototype.setDetune=function(e){return this.soundSource.detune.value=e,this},v.prototype.setPanning=function(e){return this.panning.location=e,a(e)&&"3d"===this.panning.type&&this.panning.node?this.panning.node.setPosition(e[0],e[1],e[2]):"number"==typeof e&&"stereo"===this.panning.type&&this.panning.node&&(this.panning.node.pan.value=e),a(e)?this.panning.type="3d":"number"==typeof e&&(this.panning.type="stereo"),this},v.prototype.setReverb=function(e){var t;return t=e&&e>0&&e<1?e:e>=1?1:0,this.reverb?(this.reverb.wet=t,this.reverb.node&&(this.reverb.node.wet.gain.value=t)):console.log("Sorry, but the wad does not contain Reverb!"),this},v.prototype.setDelay=function(e,t,i){var n;n=e&&e>0?e:0;var a;a=t&&t>0&&t<1?t:t>=1?1:0;var s;return s=i&&i>0&&i<1?i:i>=1?1:0,this.delay?(this.delay.delayTime=n,this.delay.wet=a,this.delay.feedback=s,this.delay.delayNode&&(this.delay.delayNode.delayNode.delayTime.value=n,this.delay.delayNode.wetNode.gain.value=a,this.delay.delayNode.feedbackNode.gain.value=s)):console.log("Sorry, but the wad does not contain delay!"),this},v.prototype.stop=function(e){if("mic"!==this.source){if(e)for(var t=0;t<this.gain.length;t++)this.gain[t].label===e&&(this.gain[t].gain.cancelScheduledValues(i.currentTime),this.gain[t].gain.setValueAtTime(this.gain[t].gain.value,i.currentTime),this.gain[t].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release));e||(this.gain[0].gain.cancelScheduledValues(i.currentTime),this.gain[0].gain.setValueAtTime(this.gain[0].gain.value,i.currentTime),this.gain[0].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release))}else v.micConsent?this.mediaStreamSource.disconnect(0):console.log("You have not given your browser permission to use your microphone.");this.tremolo&&this.tremolo.wad.stop()};var F=2048,N=new Uint8Array(F),A=function(e){var t=12*(Math.log(e/440)/Math.log(2));return Math.round(t)+69};v.Poly=function(e){e||(e={}),this.isSetUp=!1,this.playable=1,e.reverb?c(this,e):this.setUp(e)},v.Poly.prototype.setUp=function(e){if(this.wads=[],this.input=i.createAnalyser(),this.input.fftSize=2048,this.nodes=[this.input],this.destination=e.destination||i.destination,this.volume=e.volume||1,this.output=i.createGain(),this.output.gain.value=this.volume,this.tuna=e.tuna||null,"undefined"!=typeof Recorder&&e.recConfig){this.rec=new Recorder(this.output,e.recConfig),this.rec.recordings=[];var t=this,n=function(e){t.rec.createWadArg.source=e,t.rec.recordings.unshift(new v(t.rec.createWadArg))};this.rec.createWad=function(e){this.createWadArg=e||{env:{hold:9001}},this.getBuffer(n)}}this.globalReverb=e.globalReverb||!1,o(this,e),this.filter&&_(this,e),this.reverb&&x(this,e),this.constructExternalFx(e,i),h(this,e),M(this,e),e.compressor&&q(this,e),f(this,e),T(this,e),C(this,e),this.nodes.push(this.output),b(this,e),this.isSetUp=!0,e.callback&&e.callback(this)},v.Poly.prototype.updatePitch=function(t){this.input.getByteTimeDomainData(N);var n=e(N,i.sampleRate);if(n!==-1&&11025!==n&&12e3!==n){var a=n;this.pitch=Math.floor(a);var s=A(a);this.noteName=v.pitchesArray[s-12]}var o=this;o.rafID=window.requestAnimationFrame(function(){o.updatePitch()})},v.Poly.prototype.stopUpdatingPitch=function(){cancelAnimationFrame(this.rafID)},v.Poly.prototype.setVolume=function(e){return this.isSetUp?this.output.gain.value=e:console.log("This PolyWad is not set up yet."),this},v.Poly.prototype.play=function(e){if(this.isSetUp)if(this.playable<1)this.playOnLoad=!0,this.playOnLoadArg=e;else{e&&e.volume&&(this.output.gain.value=e.volume,e.volume=void 0);for(var t=0;t<this.wads.length;t++)this.wads[t].play(e)}else console.log("This PolyWad is not set up yet.");return this},v.Poly.prototype.stop=function(e){if(this.isSetUp)for(var t=0;t<this.wads.length;t++)this.wads[t].stop(e)},v.Poly.prototype.add=function(e){return this.isSetUp?(e.destination=this.input,this.wads.push(e),e instanceof v.Poly&&(e.output.disconnect(0),e.output.connect(this.input))):console.log("This PolyWad is not set up yet."),this},v.Poly.prototype.remove=function(e){if(this.isSetUp)for(var t=0;t<this.wads.length;t++)this.wads[t]===e&&(this.wads[t].destination=i.destination,this.wads.splice(t,1),e instanceof v.Poly&&(e.output.disconnect(0),e.output.connect(i.destination)));return this},v.Poly.prototype.constructExternalFx=function(e,t){},v.defaultImpulse="https://www.codecur.io/audio/widehall.wav",v.setGlobalReverb=function(e){v.reverb={},v.reverb.node=i.createConvolver(),v.reverb.gain=i.createGain(),v.reverb.gain.gain.value=e.wet;var t=e.impulse||v.defaultImpulse,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(e){v.reverb.node.buffer=e})},n.send()};var R=function(e,t){var i=null==e?t:e;return i};v.pitches={A0:27.5,"A#0":29.1352,Bb0:29.1352,B0:30.8677,"B#0":32.7032,Cb1:30.8677,C1:32.7032,"C#1":34.6478,Db1:34.6478,D1:36.7081,"D#1":38.8909,Eb1:38.8909,E1:41.2034,Fb1:41.2034,"E#1":43.6535,F1:43.6535,"F#1":46.2493,Gb1:46.2493,G1:48.9994,"G#1":51.9131,Ab1:51.9131,A1:55,"A#1":58.2705,Bb1:58.2705,B1:61.7354,Cb2:61.7354,"B#1":65.4064,C2:65.4064,"C#2":69.2957,Db2:69.2957,D2:73.4162,"D#2":77.7817,Eb2:77.7817,E2:82.4069,Fb2:82.4069,"E#2":87.3071,F2:87.3071,"F#2":92.4986,Gb2:92.4986,G2:97.9989,"G#2":103.826,Ab2:103.826,A2:110,"A#2":116.541,Bb2:116.541,B2:123.471,Cb3:123.471,"B#2":130.813,C3:130.813,"C#3":138.591,Db3:138.591,D3:146.832,"D#3":155.563,Eb3:155.563,E3:164.814,Fb3:164.814,"E#3":174.614,F3:174.614,"F#3":184.997,Gb3:184.997,G3:195.998,"G#3":207.652,Ab3:207.652,A3:220,"A#3":233.082,Bb3:233.082,B3:246.942,Cb4:246.942,"B#3":261.626,C4:261.626,"C#4":277.183,Db4:277.183,D4:293.665,"D#4":311.127,Eb4:311.127,E4:329.628,Fb4:329.628,"E#4":349.228,F4:349.228,"F#4":369.994,Gb4:369.994,G4:391.995,"G#4":415.305,Ab4:415.305,A4:440,"A#4":466.164,Bb4:466.164,B4:493.883,Cb5:493.883,"B#4":523.251,C5:523.251,"C#5":554.365,Db5:554.365,D5:587.33,"D#5":622.254,Eb5:622.254,E5:659.255,Fb5:659.255,"E#5":698.456,F5:698.456,"F#5":739.989,Gb5:739.989,G5:783.991,"G#5":830.609,Ab5:830.609,A5:880,"A#5":932.328,Bb5:932.328,B5:987.767,Cb6:987.767,"B#5":1046.5,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,Fb6:1318.51,E6:1318.51,"E#6":1396.91,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,Cb7:1975.53,"B#6":2093,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,Fb7:2637.02,"E#7":2793.83,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,Cb8:3951.07,"B#7":4186.01,C8:4186.01},v.pitchesArray=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8"],v.assignMidiMap=function(e,t,i,n){var t=t||0;navigator.requestMIDIAccess().then(function(){v.midiInputs[t]?(v.midiInputs[t].onmidimessage=e,"function"==typeof i&&i()):"function"==typeof n&&n()})},v.midiInstrument={play:function(){console.log("playing midi")},stop:function(){console.log("stopping midi")}},v.midiInputs=[];var D=function(e){console.log(e.receivedTime,e.data),144===e.data[0]?0===e.data[2]?(console.log("|| stopping note: ",v.pitchesArray[e.data[1]-12]),v.midiInstrument.stop(v.pitchesArray[e.data[1]-12])):e.data[2]>0&&(console.log("> playing note: ",v.pitchesArray[e.data[1]-12]),v.midiInstrument.play({pitch:v.pitchesArray[e.data[1]-12],label:v.pitchesArray[e.data[1]-12],callback:function(e){}})):176===e.data[0]?(console.log("controller"),46==e.data[1]&&(127==e.data[2]?v.midiInstrument.pedalMod=!0:0==e.data[2]&&(v.midiInstrument.pedalMod=!1))):224===e.data[0]&&console.log("pitch bend")},O=function(e){v.midiInputs=[];for(var t=e.inputs.values(),i=t.next();!i.done;i=t.next())v.midiInputs.push(i.value);console.log("MIDI inputs: ",v.midiInputs);for(var n=0;n<v.midiInputs.length;n++)v.midiInputs[n].onmidimessage=D},E=function(e){console.log("Failed to get MIDI access",e)};if(navigator&&navigator.requestMIDIAccess)try{navigator.requestMIDIAccess().then(O,E)}catch(e){console.log("Failed to get MIDI access",e)}return v.presets={hiHatClosed:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.03,release:.01},filter:{type:"highpass",frequency:400,q:1}},snare:{source:"noise",env:{attack:.001,decay:.01,sustain:.2,hold:.03,release:.02},filter:{type:"bandpass",frequency:300,q:.18}},hiHatOpen:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.43,release:.01},filter:{type:"highpass",frequency:100,q:.2}},ghost:{source:"square",volume:.3,env:{attack:.01,decay:.002,sustain:.5,hold:2.5,release:.3},filter:{type:"lowpass",frequency:600,q:7,env:{attack:.7,frequency:1600}},vibrato:{attack:8,speed:8,magnitude:100}},piano:{source:"square",volume:1.4,env:{attack:.01,decay:.005,sustain:.2,hold:.015,release:.3},filter:{type:"lowpass",frequency:1200,q:8.5,env:{attack:.2,frequency:600}}}},v}();return"undefined"!=typeof t&&t.exports&&(t.exports=a),a})},{}],4:[function(e,t,i){(function(){function e(e){this._value=e}function i(e,t,i,n){var a,s,o=Math.pow(10,t);return s=(i(e*o)/o).toFixed(t),n&&(a=new RegExp("0{1,"+n+"}$"),s=s.replace(a,"")),s}function n(e,t,i){var n;return n=t.indexOf("$")>-1?s(e,t,i):t.indexOf("%")>-1?o(e,t,i):t.indexOf(":")>-1?r(e,t):l(e._value,t,i)}function a(e,t){var i,n,a,s,o,r=t,l=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=!1;if(t.indexOf(":")>-1)e._value=u(t);else if(t===y)e._value=0;else{for("."!==v[m].delimiters.decimal&&(t=t.replace(/\./g,"").replace(v[m].delimiters.decimal,".")),i=new RegExp("[^a-zA-Z]"+v[m].abbreviations.thousand+"(?:\\)|(\\"+v[m].currency.symbol+")?(?:\\))?)?$"),n=new RegExp("[^a-zA-Z]"+v[m].abbreviations.million+"(?:\\)|(\\"+v[m].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+v[m].abbreviations.billion+"(?:\\)|(\\"+v[m].currency.symbol+")?(?:\\))?)?$"),s=new RegExp("[^a-zA-Z]"+v[m].abbreviations.trillion+"(?:\\)|(\\"+v[m].currency.symbol+")?(?:\\))?)?$"),o=0;o<=l.length&&!(c=t.indexOf(l[o])>-1&&Math.pow(1024,o+1));o++);e._value=(c?c:1)*(r.match(i)?Math.pow(10,3):1)*(r.match(n)?Math.pow(10,6):1)*(r.match(a)?Math.pow(10,9):1)*(r.match(s)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),
e._value=c?Math.ceil(e._value):e._value}return e._value}function s(e,t,i){var n,a,s=t.indexOf("$"),o=t.indexOf("("),r=t.indexOf("-"),u="";return t.indexOf(" $")>-1?(u=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(u=" ",t=t.replace("$ ","")):t=t.replace("$",""),a=l(e._value,t,i),s<=1?a.indexOf("(")>-1||a.indexOf("-")>-1?(a=a.split(""),n=1,(s<o||s<r)&&(n=0),a.splice(n,0,v[m].currency.symbol+u),a=a.join("")):a=v[m].currency.symbol+u+a:a.indexOf(")")>-1?(a=a.split(""),a.splice(-1,0,u+v[m].currency.symbol),a=a.join("")):a=a+u+v[m].currency.symbol,a}function o(e,t,i){var n,a="",s=100*e._value;return t.indexOf(" %")>-1?(a=" ",t=t.replace(" %","")):t=t.replace("%",""),n=l(s,t,i),n.indexOf(")")>-1?(n=n.split(""),n.splice(-1,0,a+"%"),n=n.join("")):n=n+a+"%",n}function r(e){var t=Math.floor(e._value/60/60),i=Math.floor((e._value-60*t*60)/60),n=Math.round(e._value-60*t*60-60*i);return t+":"+(i<10?"0"+i:i)+":"+(n<10?"0"+n:n)}function u(e){var t=e.split(":"),i=0;return 3===t.length?(i+=60*Number(t[0])*60,i+=60*Number(t[1]),i+=Number(t[2])):2===t.length&&(i+=60*Number(t[0]),i+=Number(t[1])),Number(i)}function l(e,t,n){var a,s,o,r,u,l,c=!1,h=!1,f=!1,p="",d=!1,b=!1,g=!1,w=!1,_=!1,k="",x="",M=Math.abs(e),L=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],G="",T=!1;if(0===e&&null!==y)return y;if(t.indexOf("(")>-1?(c=!0,t=t.slice(1,-1)):t.indexOf("+")>-1&&(h=!0,t=t.replace(/\+/g,"")),t.indexOf("a")>-1&&(d=t.indexOf("aK")>=0,b=t.indexOf("aM")>=0,g=t.indexOf("aB")>=0,w=t.indexOf("aT")>=0,_=d||b||g||w,t.indexOf(" a")>-1?(p=" ",t=t.replace(" a","")):t=t.replace("a",""),M>=Math.pow(10,12)&&!_||w?(p+=v[m].abbreviations.trillion,e/=Math.pow(10,12)):M<Math.pow(10,12)&&M>=Math.pow(10,9)&&!_||g?(p+=v[m].abbreviations.billion,e/=Math.pow(10,9)):M<Math.pow(10,9)&&M>=Math.pow(10,6)&&!_||b?(p+=v[m].abbreviations.million,e/=Math.pow(10,6)):(M<Math.pow(10,6)&&M>=Math.pow(10,3)&&!_||d)&&(p+=v[m].abbreviations.thousand,e/=Math.pow(10,3))),t.indexOf("b")>-1)for(t.indexOf(" b")>-1?(k=" ",t=t.replace(" b","")):t=t.replace("b",""),o=0;o<=L.length;o++)if(a=Math.pow(1024,o),s=Math.pow(1024,o+1),e>=a&&e<s){k+=L[o],a>0&&(e/=a);break}return t.indexOf("o")>-1&&(t.indexOf(" o")>-1?(x=" ",t=t.replace(" o","")):t=t.replace("o",""),x+=v[m].ordinal(e)),t.indexOf("[.]")>-1&&(f=!0,t=t.replace("[.]",".")),r=e.toString().split(".")[0],u=t.split(".")[1],l=t.indexOf(","),u?(u.indexOf("[")>-1?(u=u.replace("]",""),u=u.split("["),G=i(e,u[0].length+u[1].length,n,u[1].length)):G=i(e,u.length,n),r=G.split(".")[0],G=G.split(".")[1].length?v[m].delimiters.decimal+G.split(".")[1]:"",f&&0===Number(G.slice(1))&&(G="")):r=i(e,null,n),r.indexOf("-")>-1&&(r=r.slice(1),T=!0),l>-1&&(r=r.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+v[m].delimiters.thousands)),0===t.indexOf(".")&&(r=""),(c&&T?"(":"")+(!c&&T?"-":"")+(!T&&h?"+":"")+r+G+(x?x:"")+(p?p:"")+(k?k:"")+(c&&T?")":"")}function c(e,t){v[e]=t}function h(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function f(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var i=h(e),n=h(t);return i>n?i:n},-(1/0))}var p,d="1.5.3",v={},m="en",y=null,b="0,0",g="undefined"!=typeof t&&t.exports;p=function(t){return p.isNumeral(t)?t=t.value():0===t||"undefined"==typeof t?t=0:Number(t)||(t=p.fn.unformat(t)),new e(Number(t))},p.version=d,p.isNumeral=function(t){return t instanceof e},p.language=function(e,t){if(!e)return m;if(e&&!t){if(!v[e])throw new Error("Unknown language : "+e);m=e}return!t&&v[e]||c(e,t),p},p.languageData=function(e){if(!e)return v[m];if(!v[e])throw new Error("Unknown language : "+e);return v[e]},p.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$"}}),p.zeroFormat=function(e){y="string"==typeof e?e:null},p.defaultFormat=function(e){b="string"==typeof e?e:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var i,n,a=this.length>>>0,s=!1;for(1<arguments.length&&(n=t,s=!0),i=0;a>i;++i)this.hasOwnProperty(i)&&(s?n=e(n,this[i],i,this):(n=this[i],s=!0));if(!s)throw new TypeError("Reduce of empty array with no initial value");return n}),p.fn=e.prototype={clone:function(){return p(this)},format:function(e,t){return n(this,e?e:b,void 0!==t?t:Math.round)},unformat:function(e){return"[object Number]"===Object.prototype.toString.call(e)?e:a(this,e?e:b)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function t(e,t,n,a){return e+i*t}var i=f.call(null,this._value,e);return this._value=[this._value,e].reduce(t,0)/i,this},subtract:function(e){function t(e,t,n,a){return e-i*t}var i=f.call(null,this._value,e);return this._value=[e].reduce(t,this._value*i)/i,this},multiply:function(e){function t(e,t,i,n){var a=f(e,t);return e*a*(t*a)/(a*a)}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t,i,n){var a=f(e,t);return e*a/(t*a)}return this._value=[this._value,e].reduce(t),this},difference:function(e){return Math.abs(p(this._value).subtract(e).value())}},g&&(t.exports=p),"undefined"==typeof ender&&(this.numeral=p),"function"==typeof define&&define.amd&&define([],function(){return p})}).call(this)},{}]},{},[1]);